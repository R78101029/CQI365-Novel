---
import ChapterLayout from '../../../layouts/ChapterLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const allChapters = await getCollection('novels');
  // Astro lowercases collection IDs, so we need case-insensitive matching
  const chapters = allChapters
    .filter(c => c.id.toLowerCase().startsWith('blindorbit/'))
    .sort((a, b) => (a.data.order || 0) - (b.data.order || 0));

  return chapters.map((chapter, index) => {
    const slug = chapter.id.replace(/^blindorbit\//i, '').replace(/\.md$/i, '');
    const prevChapter = index > 0 ? chapters[index - 1] : null;
    const nextChapter = index < chapters.length - 1 ? chapters[index + 1] : null;

    return {
      params: { slug },
      props: {
        chapter,
        prevChapter: prevChapter ? {
          slug: prevChapter.id.replace(/^blindorbit\//i, '').replace(/\.md$/i, ''),
          title: prevChapter.data.title,
        } : null,
        nextChapter: nextChapter ? {
          slug: nextChapter.id.replace(/^blindorbit\//i, '').replace(/\.md$/i, ''),
          title: nextChapter.data.title,
        } : null,
      },
    };
  });
}

const { chapter, prevChapter, nextChapter } = Astro.props;
const { Content } = await render(chapter);
---

<ChapterLayout
  title={chapter.data.title}
  novelTitle="盲軌：2028 (Blind Orbit)"
  novelSlug="BlindOrbit"
  prevChapter={prevChapter}
  nextChapter={nextChapter}
  coverUrl={chapter.data.cover_url}
  cover={chapter.data.cover}
>
  <Content />
</ChapterLayout>
