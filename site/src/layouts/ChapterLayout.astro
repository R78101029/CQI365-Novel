---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  novelTitle: string;
  novelSlug: string;
  chapterNumber?: string;
  prevChapter?: { slug: string; title: string } | null;
  nextChapter?: { slug: string; title: string } | null;
  coverUrl?: string;
  cover?: string;
}

const {
  title,
  novelTitle,
  novelSlug,
  chapterNumber,
  prevChapter,
  nextChapter,
  coverUrl,
  cover
} = Astro.props;

// Extract short novel title (e.g., "盲軌：2028" from "盲軌：2028 (Blind Orbit)")
const shortNovelTitle = novelTitle.split(' ')[0];

// Resolve cover image URL
let coverImageUrl: string | null = null;
if (coverUrl) {
  coverImageUrl = coverUrl;
} else if (cover) {
  coverImageUrl = `/assets/${novelSlug}/chapters/${cover}`;
}
---

<BaseLayout title={`【${shortNovelTitle}】${title}`}>
  <article class="container">
    <header class="chapter-header">
      <p class="meta">
        <a href={`/novel/${novelSlug}`}>{novelTitle}</a>
      </p>
      {chapterNumber && <span class="chapter-number">{chapterNumber}</span>}
      <h1>【{shortNovelTitle}】{title}</h1>
      {coverImageUrl && (
        <figure class="chapter-cover">
          <img src={coverImageUrl} alt={title} />
        </figure>
      )}
    </header>

    <div class="chapter-content">
      <slot />
    </div>

    <nav class="chapter-nav">
      {prevChapter ? (
        <a href={`/novel/${novelSlug}/${prevChapter.slug}`}>
          <span>←</span>
          <span>{prevChapter.title}</span>
        </a>
      ) : <span></span>}

      {nextChapter ? (
        <a href={`/novel/${novelSlug}/${nextChapter.slug}`}>
          <span>{nextChapter.title}</span>
          <span>→</span>
        </a>
      ) : <span></span>}
    </nav>
  </article>
</BaseLayout>
